package com.bcvgh.core.exploit;
import com.bcvgh.core.exploit.pojo.ResPattern;
import com.bcvgh.core.pojo.Payload;
import com.bcvgh.utils.Response;

import java.util.HashMap;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class BaseTemplate {
    public String url;
    public String name;
    public String tag;
    public String type;
    public HashMap<String,Object> header;
    private String ResText;


    public BaseTemplate(String url, Payload payload) {
        this.url = url;
        this.name = payload.name;
        this.tag = payload.tag;
        this.type = payload.type;
    }

//    public String resMatch(Response response,Pattern)

    public String resMatch(Response response, String PatternText){
        ResPattern resPattern = new ResPattern(PatternText);
        if (resPattern.getResType().equals("text")){
            this.ResText = response.getText();
        }
        if (resPattern.getResType().equals("head")){
            this.ResText = response.getHead();
        }

        try {
            Matcher matcher = resPattern.getPattern().matcher(this.ResText);
            if (matcher.find()){
                return matcher.group(1);
            }
        }catch (Exception e){
            return null;
        }
        return null;
    }

    public String resMatch(String resText,Pattern pattern){
        try {
            Matcher matcher = pattern.matcher(resText);
            if (matcher.find()){
                return matcher.group(1);
            }
        }catch (Exception e){
            return null;
        }
        return null;
    }


}
